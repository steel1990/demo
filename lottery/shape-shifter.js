"use strict";var S={init:function(){var a=window.location.href,b=a.indexOf("?a=");S.Drawing.init(".canvas"),S.ShapeBuilder.init(),S.UI.init(),document.body.classList.add("body--ready"),b!==-1?S.UI.simulate(decodeURI(a).substring(b+3)):S.UI.simulate("#rectangle 100x100"),S.Drawing.loop(function(){S.Shape.render()})}};window.addEventListener("load",function(){S.init()}),S.Drawing=function(){var a,b,c,d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)};return{init:function(c){a=document.querySelector(c),b=a.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",function(){S.Drawing.adjustCanvas()})},loop:function(a){c=c?c:a,this.clearFrame(),c(),d.call(window,this.loop.bind(this))},adjustCanvas:function(){a.width=window.innerWidth,a.height=window.innerHeight},clearFrame:function(){b.clearRect(0,0,a.width,a.height)},getArea:function(){return{w:a.width,h:a.height}},drawCircle:function(a,c){b.fillStyle=c.render(),b.beginPath(),b.arc(a.x,a.y,a.z,0,2*Math.PI,!0),b.closePath(),b.fill()}}}(),S.Point=function(a){this.x=a.x,this.y=a.y,this.z=a.z,this.a=a.a,this.h=a.h},S.Color=function(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d},S.Color.prototype={render:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"}},S.UI=function(){function a(a){var b=a.getHours(),c=a.getMinutes();return c=c<10?"0"+c:c,b+":"+c}function b(a){return a&&a.split(" ")[1]}function c(a){return a=a&&a.split(" ")[0],a&&a[0]===m&&a.substring(1)}function d(a,b,c,d){clearInterval(g),h=d?c:1,a(h),(!c||!d&&h<c||d&&h>0)&&(g=setInterval(function(){h=d?h-1:h+1,a(h),(!d&&c&&h===c||d&&0===h)&&clearInterval(g)},b))}function e(a){clearInterval(g),l=[],i=null,a&&S.Shape.switchShape(S.ShapeBuilder.letter(""))}function f(e){var g,h;j.classList.remove("overlay--visible"),l="object"==typeof e?e:l.concat(e.split("|")),d(function(){switch(h=l.shift(),g=c(h),e=b(h),g){case"countdown":e=parseInt(e,10)||10,e=e>0?e:10,d(function(a){0===a?0===l.length?S.Shape.switchShape(S.ShapeBuilder.letter("")):f(l):S.Shape.switchShape(S.ShapeBuilder.letter(a),!0)},1e3,e,!0);break;case"rectangle":e=e&&e.split("x"),e=e&&2===e.length?e:[k,k/2],S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(k,parseInt(e[0],10)),Math.min(k,parseInt(e[1],10))));break;case"circle":e=parseInt(e,10)||k,e=Math.min(e,k),S.Shape.switchShape(S.ShapeBuilder.circle(e));break;case"time":var j=a(new Date);l.length>0?S.Shape.switchShape(S.ShapeBuilder.letter(j)):d(function(){j=a(new Date),j!==i&&(i=j,S.Shape.switchShape(S.ShapeBuilder.letter(i)))},1e3);break;case"icon":S.ShapeBuilder.imageFile("font-awesome/"+e+".png",function(a){S.Shape.switchShape(a)});break;default:S.Shape.switchShape(S.ShapeBuilder.letter(h[0]===m?"What?":h))}},2e3,l.length)}var g,h,i,j=(document.querySelector(".ui-input"),document.querySelector(".ui"),document.querySelector(".help"),document.querySelector(".commands"),document.querySelector(".overlay")),k=(document.querySelector(".canvas"),"ontouchstart"in window||navigator.msMaxTouchPoints,30),l=[],m="#";return{init:function(){},simulate:function(a){f(a)},reset:e}}(),S.UI.Tabs=function(){function a(a){d[a].classList.add("tabs-label--active"),e[a].classList.add("tabs-panel--active")}function b(){c.addEventListener("click",function(b){var c,f=b.target;if(f.classList.contains("tabs-label")){for(var g=0;g<d.length;g++)d[g].classList.remove("tabs-label--active"),e[g].classList.remove("tabs-panel--active"),f===d[g]&&(c=g);a(c)}})}var c=document.querySelector(".tabs-labels"),d=document.querySelectorAll(".tabs-label"),e=document.querySelectorAll(".tabs-panel");return{init:function(){a(0),b()}}}(),S.Dot=function(a,b){this.p=new S.Point({x:a,y:b,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(a){var b=this.distanceTo(a,!0),c=b[0],d=b[1],e=b[2],f=this.e*e;if(this.p.h===-1)return this.p.x=a.x,this.p.y=a.y,!0;if(e>1)this.p.x-=c/e*f,this.p.y-=d/e*f;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){var a,b;this._moveTowards(this.t)&&(a=this.q.shift(),a?(this.t.x=a.x||this.p.x,this.t.y=a.y||this.p.y,this.t.z=a.z||this.p.z,this.t.a=a.a||this.p.a,this.p.h=a.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))),b=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*b),b=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*b)},distanceTo:function(a,b){var c=this.p.x-a.x,d=this.p.y-a.y,e=Math.sqrt(c*c+d*d);return b?[c,d,e]:e},move:function(a,b){(!b||b&&this.distanceTo(a)>1)&&this.q.push(a)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){function a(){f.width=Math.floor(window.innerWidth/e)*e,f.height=Math.floor(window.innerHeight/e)*e,g.fillStyle="red",g.textBaseline="middle",g.textAlign="center"}function b(){for(var a=g.getImageData(0,0,f.width,f.height).data,b=[],c=0,d=0,h=f.width,i=f.height,j=0,k=0,l=0;l<a.length;l+=4*e)a[l+3]>0&&(b.push(new S.Point({x:c,y:d})),j=c>j?c:j,k=d>k?d:k,h=c<h?c:h,i=d<i?d:i),c+=e,c>=f.width&&(c=0,d+=e,l+=4*e*f.width);return{dots:b,w:j+h,h:k+i}}function c(a){g.font="bold "+a+"px "+i}function d(a){return!isNaN(parseFloat(a))&&isFinite(a)}var e=13,f=document.createElement("canvas"),g=f.getContext("2d"),h=500,i="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif";return{init:function(){a(),window.addEventListener("resize",a)},imageFile:function(a,c){var d=new Image,e=S.Drawing.getArea();d.onload=function(){g.clearRect(0,0,f.width,f.height),g.drawImage(this,0,0,.6*e.h,.6*e.h),c(b())},d.onerror=function(){c(S.ShapeBuilder.letter("What?"))},d.src=a},circle:function(a){var c=Math.max(0,a)/2;return g.clearRect(0,0,f.width,f.height),g.beginPath(),g.arc(c*e,c*e,c*e,0,2*Math.PI,!1),g.fill(),g.closePath(),b()},letter:function(a){var e=0;return c(h),e=Math.min(h,f.width/g.measureText(a).width*.8*h,f.height/h*(d(a)?1:.45)*h),c(e),g.clearRect(0,0,f.width,f.height),g.fillText(a,f.width/2,f.height/2),b()},rectangle:function(a,b){for(var c=[],d=e*a,f=e*b,g=0;g<f;g+=e)for(var h=0;h<d;h+=e)c.push(new S.Point({x:h,y:g}));return{dots:c,w:d,h:f}}}}(),S.Shape=function(){function a(){var a=S.Drawing.getArea();e=a.w/2-c/2,f=a.h/2-d/2}var b=[],c=0,d=0,e=0,f=0;return{shuffleIdle:function(){for(var a=S.Drawing.getArea(),c=0;c<b.length;c++)b[c].s||b[c].move({x:Math.random()*a.w,y:Math.random()*a.h})},switchShape:function(g,h){var i,j=S.Drawing.getArea(),k=0,l=0;if(c=g.w,d=g.h,a(),g.dots.length>b.length)for(i=g.dots.length-b.length,k=1;k<=i;k++)b.push(new S.Dot(j.w/2,j.h/2));for(k=0;g.dots.length>0;)l=Math.floor(Math.random()*g.dots.length),b[k].e=h?.25:b[k].s?.14:.11,b[k].s?b[k].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:18})):b[k].move(new S.Point({z:5*Math.random()+5,h:h?18:30})),b[k].s=!0,b[k].move(new S.Point({x:g.dots[l].x+e,y:g.dots[l].y+f,a:1,z:5,h:0})),g.dots=g.dots.slice(0,l).concat(g.dots.slice(l+1)),k++;for(l=k;l<b.length;l++)b[l].s&&(b[l].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),b[l].s=!1,b[l].e=.04,b[l].move(new S.Point({x:Math.random()*j.w,y:Math.random()*j.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var a=0;a<b.length;a++)b[a].render()}}}(),S.lottery=function(){function a(a){var b=0xe98391e99baf,c=b.toString(16);c=c.toUpperCase(),a&&(c=a);var d=/(?=(?:\w\w)+$)/g;return m(c.replace(d,n(37)))}function b(){try{var a=JSON.parse(localStorage._lotteryInfo)}catch(b){a={}}k=a.nameList||["屈原","项羽","苏武","嵇康","陶渊明","曹植","曹丕","曹操","阮籍","张融","王僧孺","白居易","杜甫","李白","刘禹锡","元稹","李商隐","杜牧","刘长卿","温庭筠","陆游","杨万里","苏轼","黄庭坚","苏辙","范成大","王安石","欧阳修","元好问"],l=a.prizedNameList||[]}function c(a,b){try{localStorage._lotteryInfo=JSON.stringify({nameList:a,prizedNameList:b})}catch(a){console.log("err")}}function d(){p=!1,o.className="disable-lottery"}function e(){l.length>=q||(p=!0,o.className="")}function f(a){S.UI.reset(!0),S.UI.simulate("#countdown 3|#rectangle 100x100|"+a),setTimeout(e,8e3)}function g(a,b){return Math.floor(Math.random()*(b-a))+a}function h(a){var b=r[a];if(!l.includes(b)&&k.includes(b)){var c=0===a?9:15,d=0===a?6:3,e=l.length,f=(e-c)/d,g=Math.random();return g<=f?b:void 0}}function i(){var a=h(0);if(a||(a=h(1)),!a)do a=k[g(0,k.length)];while(l.includes(a)||r.includes(a));return l.push(a),c(k,l),a}function j(){b(),o.innerText="开始抽奖X"+(q-l.length),o.addEventListener("click",function(){if(p){d();var a=i();f(a),o.innerText="开始抽奖X"+(q-l.length)}})}var k,l,m=decodeURIComponent,n=String.fromCharCode,o=document.getElementById("lottery-btn"),p=!0,q=19,r=[a(),a("E99988E7ABA0E685A7")];Array.prototype.includes=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return!0;return!1},j()}();